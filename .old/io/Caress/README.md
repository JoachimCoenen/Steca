Taken from branch adhoc (old STeCa version), minimal changes.
